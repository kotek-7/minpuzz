みんパズ技術仕様ハイライト

- フルスタックTypeScript
  - フロントエンド(Next.js/React)、バックエンド(Node.js/Express)を含むすべてのコードベースをTypeScriptで統一した。
  - 始めにドメインを型で表現し、クライアントとサーバー間のデータ構造の整合性をコンパイル時に検証する。

- サーバー権威アーキテクチャとリアルタイム通信
  - 通信プロトコルとしてWebSocket (Socket.ioライブラリ) を採用し、低遅延な双方向通信を実現する。
  - ゲームの状態遷移に関わるロジックと検証は全てサーバーサイドで実行するサーバー権威モデルを採用した。
  - このモデルにより、クライアントからの不正な操作を防ぎ、全クライアントの状態整合性を担保する。
  - クライアントとサーバー間のやり取りはドメインイベントとして定義し、疎結合で柔軟性の高い設計とした。

- ハイブリッドデータストア戦略 (PostgreSQL + Redis)
  - データの特性に応じ、永続ストアとインメモリキャッシュを使い分けるハイブリッド戦略を採用した。
  - PostgreSQL (Supabase) はPrismaも導入して丁寧にセットアップしたけど結局あまり使わなかった。
  - Redis (Upstash)を、ゲーム中のセッション情報、ピースの配置状況、スコア、タイマーといった、揮発性で高頻度な読み書きが要求されるデータの管理に使用する。
  - この戦略により、メインデータベースへの負荷を軽減し、リアルタイム性が要求される処理において高いパフォーマンスを維持する。

- 型安全性
  - Branded Typesを導入し、stringやnumberといったプリミティブ型に対し、型システム上で意味的な区別を与えるカスタム型を定義した。これにより、UserIdを期待する関数にTeamIdを渡すといった型レベルのエラーをコンパイル時に検出する。
  - neverthrowライブラリを利用し、Result型によるエラーハンドリングを実装した。例外(throw)機構を用いず、成功と失敗のパスを型で明示することで、エラー処理の漏れを防止し、コードの可読性と安定性を向上させる。
  - Zodによるスキーマバリデーションをシステムの境界で実行する。外部から受け取るデータの構造と型を検証し、ドメインロジック内では常にデータの正しさが保証された状態で処理を実行できる。

- 品質保証のためのテスト戦略
  - リアルタイム通信がもたらす複雑性と非同期性に対応するため、多層的なテスト戦略を立てた。
  - ユニットテストでは、関数型の純粋なドメインロジックやユーティリティ関数を対象とし、個々の機能の正しさを検証する。
  - 統合テストでは、データベースや外部サービスをモック化し、複数のユニットが連携して動作することを検証する。
  - シナリオテストでは、複数プレイヤーの操作が競合する状況など、実際のユースケースを模したシナリオに基づき、システム全体の振る舞いが期待通りであることを確認する。

- MVCアーキテクチャに基づいた関心の分離
  - プロジェクト全体でModel-View-Controller (MVC) の設計思想を応用し、責務を明確に分離した。
  - Model: ドメインロジックとビジネスルールを担当する (`backend/src/model/`)。状態を持たず、純粋な関数で構成され、テスト容易性が高い。データ永続化はリポジトリ層 (`backend/src/repository/`) が担う。Redisの操作をServiceにラップしてもよかったがそこまででもないかなと思った
  - View: ユーザーインターフェースの表示に専念する (`frontend/src/features/`)。Reactコンポーネントで構築され、状態に応じて宣言的にUIをレンダリングする。
  - Controller: ユーザーからの入力を処理し、ModelとViewを仲介する。この責務は、HTTPリクエストを扱うREST APIコントローラ (`backend/src/controller/`) と、リアルタイム通信を扱うWebSocketゲートウェイ (`backend/src/socket/`) に明確に分離されている。
  - この分離により、各コンポーネントは独立して開発・テストが可能になり、コードベース全体のメンテナンス性が向上した。
