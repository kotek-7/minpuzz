# ゲーム詳細仕様
## 概要
リアルタイム対戦パズルゲーム。3~4人2チームに分かれて各チームでリアルタイムでジグゾ―パズルを解き、先に完成した or 制限時間 (2分) 内に先まで進んだ方の勝ち

## 画面イメージ
```
+------------------------------------+
|          |                         |
| 残り 1:23 | [相手の絵(シルエットonly)] |
|          |                         |
+------------------------------------+
|                                    |
|                                    |
|                                    |
|                                    |
|              パズル                 |
|                                    |
|                                    |
|                                    |
|                                    |
+------------------------------------+
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
|        ピースがばらまかれて           |
|           いる場所(ボード)           |
|                                    |
|                                    |
|                                    |
|                                    |
|                                    |
+------------------------------------+
```

## ゲームの流れ（クリック配置）
1. ゲームスタート
2. 各チームのメンバーはボード上の未配置ピースを選択し、パズルエリア（盤面）のセルをクリックして配置する（ドラッグ操作は廃止）
3. パズルは6x6で、盤面の各セルに1つのみ配置できる
4. 選択状態と配置結果はリアルタイムでチーム全員に共有され、進捗が確認できる
5. 同一ピースまたは同一セルへの同時操作が発生した場合は先着を有効とし、後続は失敗として扱う（再試行可）
6. 制限時間が終わったときにより進んでいる、または先にパズルが完成すると勝ち
7. 結果画面

## その他
- 右上に相手のパズルのシルエットのみ (カンニング防止のため) が表示されて、進捗状況が確認できる
- 相手と自分の正解ピースの数が表示される (27/35 みたいに)

## 参考ドキュメント
- ゲーム接続後〜ゲーム中（通常操作）: `docs/in-game/sequence-in-game.mmd`（本仕様のクリック配置に読み替え）
- ゲーム中（同時操作の競合）: `docs/in-game/sequence-in-game-conflict.mmd`（旧「同時掴み」相当の競合を示す）
- ゲーム中（タイマー同期）: `docs/in-game/sequence-in-game-timer-sync.mmd`
- ゲーム終了と結果通知フロー: `docs/sequence-game-end.mmd`
- ゲーム中/終了のイベント仕様一覧: `docs/in-game/events-game.md`
- バックエンド実装計画（M/U進行表）: `docs/implementation-plan.md`

---

## ピース配置（クリック式）- ビジネス要件

### 目的
- シンプル操作: ドラッグを廃止し「ピース選択 → セル選択 → 配置」に統一する。
- 共同作業性: 配置結果が即座に共有され、チームの進捗が明瞭に把握できる。
- 誤操作低減: 無効セルや重複配置を事前/即時に防止する。

### 対象ユーザー
- チーム対戦に参加する一般プレイヤー（PC/スマホ）。
- リーダー等の特別権限は設けない（公平性を重視）。

### スコープ
- 対象: ピースの選択・配置、配置結果の共有、進捗表示、基本的なエラー表示。
- 非対象: ドラッグ移動、自由移動、スナップ/物理アニメーションなどの演出。

### 基本フロー
- ピース選択: 未配置ピースを一覧から1つ選ぶ（選択状態を視覚的に強調）。
- セル選択: 盤面の空セルをクリック（占有セルは選べない）。
- 配置確定: 成功時は即座に画面反映・チーム共有。失敗時は理由を表示し選択は維持（再試行可）。
- 取消/変更: 別ピースへの選び直し、または選択解除が可能。

### 業務ルール
- 占有禁止: 既にピースがあるセルには置けない。
- 一意配置: 同じピースは一度しか確定配置できない。
- 妥当性:
  - 盤面外は不可。
  - 誤セルの扱い
    - 任意セルに仮配置可だが、スコア対象は正解のみ。
- 公平性: 同時操作は先着を有効・後続は失敗として扱う。

### エラーとメッセージ
- セル占有: 「そのマスは使用中です」
- 既配置: 「そのピースは配置済みです」
- 無効セル: 「その位置には置けません」
- 競合: 「ほかのメンバーの操作が優先されました」
- 表示方針: 明確・短文・再試行案内つき（選択状態は維持）。

### 視覚要件（ビジネス観点）
- 選択状態: 色/枠/拡大などで強調。
- 盤面ガイド: クリック可能セルの見た目を区別。ホバー/フォーカスで補助。
- 進捗表示: 配置済み数・残数などを常時表示。

### 同時操作の扱い
- 先着優先: 同一ピース/同一セルへの同時操作は先に確定したものを有効とする。
- 可視化（任意要件）: 誰がどのピースを操作中か表示できると望ましい。

### ゲーム終了条件
- 完成: すべてのピースを正しく配置した時点で終了。
- タイムアップ: 制限時間到達で終了（終了メッセージと結果表示）。
- 途中離脱: メンバー離脱があっても継続可能（残メンバーで続行）。

### アクセシビリティ/文言
- キーボード: ピース選択・セル移動・配置をキーボードでも可能に。
- 文言: 明快・前向き・再試行を促す表現。日本語。

> 注: 本セクションはビジネス要件のみを記述する。技術的なイベント名・実装は他ドキュメント（events/sequence）を参照。
